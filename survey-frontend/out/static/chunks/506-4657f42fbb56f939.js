"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[506],{8506:(e,t,n)=>{n.d(t,{V:()=>c});var r=n(5155),o=n(8173),a=n.n(o),l=n(9959),s=n(2115);function c(){let{address:e,isConnected:t,isConnecting:n,providers:o,connect:c,disconnect:i}=(0,l.v)(),[d,u]=(0,s.useState)(!1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("nav",{className:"glass border-b border-gray-200 dark:border-gray-700 px-6 py-4",children:(0,r.jsxs)("div",{className:"max-w-7xl mx-auto flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-8",children:[(0,r.jsxs)(a(),{href:"/",className:"flex items-center space-x-2 hover:opacity-80 transition-opacity",children:[(0,r.jsx)("div",{className:"w-8 h-8 bg-gradient-to-br from-primary to-secondary rounded-lg flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-white font-bold text-lg",children:"S"})}),(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"FHEVM Survey"})]}),t&&(0,r.jsxs)("div",{className:"hidden md:flex space-x-6",children:[(0,r.jsx)(a(),{href:"/surveys",className:"text-gray-600 hover:text-primary dark:text-gray-300 transition-colors",children:"Browse"}),(0,r.jsx)(a(),{href:"/create",className:"text-gray-600 hover:text-primary dark:text-gray-300 transition-colors",children:"Create"}),(0,r.jsx)(a(),{href:"/my-surveys",className:"text-gray-600 hover:text-primary dark:text-gray-300 transition-colors",children:"My Surveys"}),(0,r.jsx)(a(),{href:"/my-participations",className:"text-gray-600 hover:text-primary dark:text-gray-300 transition-colors",children:"My Participations"})]})]}),(0,r.jsx)("div",{className:"flex items-center space-x-4",children:t&&e?(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,r.jsx)("div",{className:"px-4 py-2 bg-gray-100 dark:bg-gray-800 rounded-lg",children:(0,r.jsx)("span",{className:"text-sm font-mono text-gray-700 dark:text-gray-300",children:"".concat(e.slice(0,6),"...").concat(e.slice(-4))})}),(0,r.jsx)("button",{onClick:i,className:"px-4 py-2 text-sm text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors",children:"Disconnect"})]}):(0,r.jsx)("button",{onClick:()=>u(!0),disabled:n,className:"px-6 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all duration-200 shadow-md disabled:opacity-50 disabled:cursor-not-allowed",children:n?"Connecting...":"Connect Wallet"})})]})}),d&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"glass-dark max-w-md w-full rounded-2xl p-6 shadow-xl",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,r.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Connect Wallet"}),(0,r.jsx)("button",{onClick:()=>u(!1),className:"text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:(0,r.jsx)("svg",{className:"w-6 h-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),0===o.length?(0,r.jsxs)("div",{className:"text-center py-8",children:[(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No wallets detected"}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-500",children:"Please install MetaMask or another Web3 wallet"})]}):(0,r.jsx)("div",{className:"space-y-3",children:o.map(e=>(0,r.jsxs)("button",{onClick:()=>{c(e),u(!1)},className:"w-full flex items-center space-x-4 p-4 bg-white dark:bg-gray-800 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-lg transition-colors border border-gray-200 dark:border-gray-700",children:[e.info.icon&&(0,r.jsx)("img",{src:e.info.icon,alt:e.info.name,className:"w-10 h-10 rounded-lg"}),(0,r.jsxs)("div",{className:"flex-1 text-left",children:[(0,r.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:e.info.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:e.info.rdns})]})]},e.info.uuid))})]})})]})}},9959:(e,t,n)=>{n.d(t,{v:()=>l});var r=n(2115),o=n(582);let a={connected:"wallet.connected",connectorId:"wallet.lastConnectorId",connectorName:"wallet.lastConnectorName",accounts:"wallet.lastAccounts",chainId:"wallet.lastChainId"};function l(){let e=function(){let[e,t]=(0,r.useState)([]);return(0,r.useEffect)(()=>{let e=new Map,n=n=>{var r;let o=n.detail;(null==o?void 0:null===(r=o.info)||void 0===r?void 0:r.uuid)&&(null==o?void 0:o.provider)&&(e.set(o.info.uuid,o),t(Array.from(e.values())),console.log("[EIP6963] Provider announced:",o.info.name))};return window.addEventListener("eip6963:announceProvider",n),window.dispatchEvent(new Event("eip6963:requestProvider")),()=>{window.removeEventListener("eip6963:announceProvider",n)}},[]),e}(),t=(0,r.useRef)(!1),[n,l]=(0,r.useState)({address:null,chainId:null,isConnected:!1,isConnecting:!1,error:null,provider:null,signer:null,rawProvider:null}),s=(0,r.useCallback)(()=>{localStorage.removeItem(a.connected),localStorage.removeItem(a.connectorId),localStorage.removeItem(a.connectorName),localStorage.removeItem(a.accounts),localStorage.removeItem(a.chainId)},[]),c=(0,r.useCallback)(e=>{console.log("[Wallet] Accounts changed:",e),0===e.length?(l({address:null,chainId:null,isConnected:!1,isConnecting:!1,error:null,provider:null,signer:null,rawProvider:null}),s()):(l(t=>({...t,address:e[0]})),localStorage.setItem(a.accounts,JSON.stringify(e)))},[s]),i=(0,r.useCallback)(e=>{let t=parseInt(e,16);console.log("[Wallet] Chain changed:",t),l(e=>({...e,chainId:t})),localStorage.setItem(a.chainId,t.toString()),window.location.reload()},[]),d=(0,r.useCallback)(()=>{console.log("[Wallet] Disconnected"),l({address:null,chainId:null,isConnected:!1,isConnecting:!1,error:null,provider:null,signer:null,rawProvider:null}),s()},[s]),u=(0,r.useCallback)(e=>{e.on("accountsChanged",c),e.on("chainChanged",i),e.on("disconnect",d)},[c,i,d]),g=(0,r.useCallback)(async function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];l(e=>({...e,isConnecting:!0,error:null}));try{let n;let r=e.provider;if(!(n=t?await r.request({method:"eth_requestAccounts"}):await r.request({method:"eth_accounts"}))||0===n.length)throw Error("No accounts found");let s=await r.request({method:"eth_chainId"}),c=parseInt(s,16),i=new o.k(r),d=await i.getSigner();localStorage.setItem(a.connected,"true"),localStorage.setItem(a.connectorId,e.info.uuid),localStorage.setItem(a.connectorName,e.info.name),localStorage.setItem(a.accounts,JSON.stringify(n)),localStorage.setItem(a.chainId,c.toString()),l({address:n[0],chainId:c,isConnected:!0,isConnecting:!1,error:null,provider:i,signer:d,rawProvider:r}),console.log("[Wallet] Connected:",n[0],"Chain:",c),u(r)}catch(e){console.error("[Wallet] Connection failed:",e),l(t=>({...t,isConnecting:!1,error:e instanceof Error?e:Error(String(e))}))}},[u]);(0,r.useEffect)(()=>{(async()=>{if(t.current)return;let n=localStorage.getItem(a.connected),r=localStorage.getItem(a.connectorId),u=localStorage.getItem(a.connectorName);if("true"===n&&(r||u)){if(0===e.length)return;await new Promise(e=>setTimeout(e,100))}if("true"===n&&e.length>0){t.current=!0,console.log("[Wallet] Auto-reconnecting..."),console.log("[Wallet] Looking for connector - UUID:",r,"Name:",u),console.log("[Wallet] Available providers:",e.map(e=>({name:e.info.name,uuid:e.info.uuid})));let n=r?e.find(e=>e.info.uuid===r):null;if(!n&&u&&(console.log("[Wallet] UUID not found, trying to find by name..."),(n=e.find(e=>e.info.name===u))&&(console.log("[Wallet] Found by name, updating stored UUID"),localStorage.setItem(a.connectorId,n.info.uuid))),!n&&(console.log("[Wallet] Exact match not found, looking for MetaMask..."),(n=e.find(e=>e.info.name.toLowerCase().includes("metamask")))&&(console.log("[Wallet] Found MetaMask, updating stored info"),localStorage.setItem(a.connectorId,n.info.uuid),localStorage.setItem(a.connectorName,n.info.name))),n){console.log("[Wallet] Using provider:",n.info.name);try{let e=n.provider,t=await e.request({method:"eth_accounts"});if(!t||0===t.length){console.log("[Wallet] No accounts found, clearing stale connection"),s();return}console.log("[Wallet] Found accounts:",t[0]);let r=await e.request({method:"eth_chainId"}),a=parseInt(r,16),u=new o.k(e),g=await u.getSigner();l({address:t[0],chainId:a,isConnected:!0,isConnecting:!1,error:null,provider:u,signer:g,rawProvider:e}),console.log("[Wallet] Auto-reconnect successful:",t[0],"Chain:",a),e.on("accountsChanged",c),e.on("chainChanged",i),e.on("disconnect",d)}catch(e){console.error("[Wallet] Auto-reconnect failed:",e),s(),t.current=!1}}else console.log("[Wallet] Last provider not found"),s()}})()},[e.length]);let m=(0,r.useCallback)(async e=>{await g(e,!0)},[g]),h=(0,r.useCallback)(()=>{l({address:null,chainId:null,isConnected:!1,isConnecting:!1,error:null,provider:null,signer:null,rawProvider:null}),s(),t.current=!1,console.log("[Wallet] Disconnected and cleared")},[s]),x=(0,r.useCallback)(async e=>{if(!n.provider)throw Error("No provider connected");try{await n.provider.provider.request({method:"wallet_switchEthereumChain",params:[{chainId:"0x".concat(e.toString(16))}]})}catch(e){if(4902===e.code)throw Error("Chain not configured in wallet");throw e}},[n.provider]);return{...n,providers:e,connect:m,disconnect:h,switchChain:x}}}}]);