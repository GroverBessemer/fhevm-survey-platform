(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[210],{8404:(e,t,a)=>{Promise.resolve().then(a.bind(a,4628))},4628:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>y});var r=a(5155),n=a(8506),s=a(9959),i=a(9827),l=a(8173),o=a.n(l),d=a(2115);function y(){let{isConnected:e,address:t}=(0,s.v)(),{getMyParticipations:a,isReady:l}=(0,i.q)(),[y,c]=(0,d.useState)([]),[u,p]=(0,d.useState)(!0);return((0,d.useEffect)(()=>{(async()=>{if(l&&e){p(!0);try{let e=await a();c(e)}catch(e){console.error("Failed to load participations:",e)}finally{p(!1)}}})()},[l,e,a]),e)?(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,r.jsx)(n.V,{}),(0,r.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-12",children:[(0,r.jsxs)("div",{className:"mb-8",children:[(0,r.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"My Participations"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Surveys you've participated in"})]}),u&&(0,r.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,r.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading your participations..."})]}),!u&&y.length>0&&(0,r.jsx)("div",{className:"space-y-4",children:y.map(e=>(0,r.jsx)("div",{className:"glass p-6 rounded-xl hover:shadow-lg transition-all",children:(0,r.jsxs)("div",{className:"flex items-start justify-between",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3 mb-3",children:[(0,r.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white",children:e.title}),(0,r.jsx)("span",{className:"px-3 py-1 rounded-full text-xs font-semibold ".concat("active"===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:e.status})]}),(0,r.jsx)("div",{className:"flex items-center space-x-6 text-sm text-gray-600 dark:text-gray-400",children:(0,r.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,r.jsx)("span",{children:"\uD83D\uDD10"}),(0,r.jsx)("span",{className:"text-encrypted font-semibold",children:"Your answers are encrypted"})]})})]}),(0,r.jsxs)("div",{className:"flex gap-2 ml-4",children:[(0,r.jsx)(o(),{href:"/surveys/".concat(e.id,"/results"),className:"px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-600 transition-colors text-sm font-semibold",children:"\uD83D\uDCCA View Results"}),(0,r.jsx)(o(),{href:"/surveys/".concat(e.id),className:"px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 border border-gray-300 dark:border-gray-600 rounded-lg hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors text-sm font-semibold",children:"View Survey"})]})]})},e.id))}),!u&&0===y.length&&(0,r.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,r.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCCA"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-6",children:"You haven't participated in any surveys yet"}),(0,r.jsx)(o(),{href:"/surveys",className:"inline-block px-8 py-3 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all font-semibold",children:"Browse Surveys"})]}),(0,r.jsxs)("div",{className:"mt-8 glass p-6 rounded-xl",children:[(0,r.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3",children:"\uD83D\uDD12 Your Privacy is Protected"}),(0,r.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"All your survey responses are encrypted on-chain using FHEVM technology. Only you and authorized parties (based on survey settings) can decrypt your answers."})]})]})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,r.jsx)(n.V,{}),(0,r.jsx)("div",{className:"max-w-2xl mx-auto px-6 py-20 text-center",children:(0,r.jsxs)("div",{className:"glass p-12 rounded-2xl",children:[(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Connect Your Wallet"}),(0,r.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:"Please connect your wallet to view your participations."})]})})]})}},9827:(e,t,a)=>{"use strict";a.d(t,{q:()=>y});var r=a(2115),n=a(5631),s=a(9959),i=a(6778);let l={abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"surveyAddress",type:"address"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint256",name:"surveyId",type:"uint256"}],name:"SurveyCreated",type:"event"},{inputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint32",name:"maxParticipants",type:"uint32"},{internalType:"enum Survey.PrivacyLevel",name:"privacyLevel",type:"uint8"},{internalType:"bool",name:"allowMultiple",type:"bool"},{components:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],internalType:"struct Survey.Question[]",name:"questions",type:"tuple[]"}],name:"createSurvey",outputs:[{internalType:"address",name:"surveyAddress",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"creatorSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getSurveyCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"creator",type:"address"}],name:"getSurveysByCreator",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"}],name:"getSurveysByParticipant",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"offset",type:"uint256"},{internalType:"uint256",name:"limit",type:"uint256"}],name:"getSurveysPaginated",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"participantSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"surveyAddress",type:"address"}],name:"recordParticipation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"surveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}]},o={0xaa36a7:{address:"0x629a3C8DE3C6083C0E24f36E9D2Ec977130B68FF",chainId:0xaa36a7,chainName:"sepolia"},31337:{address:"0x71A42B3B6bB0D1772C47605400De02F985d400A7",chainId:31337,chainName:"hardhat"}};var d=a(3186);function y(){let{signer:e,chainId:t,isConnected:a,address:y,rawProvider:c}=(0,s.v)(),{instance:u,isLoading:p}=(0,i.w)(c),[m,v]=(0,r.useState)(null),[g,x]=(0,r.useState)(!1),[h,b]=(0,r.useState)(null);(0,r.useEffect)(()=>{if(!e||!t){v(null);return}try{var a;let r=t.toString(),s=null===(a=o[r])||void 0===a?void 0:a.address;if(!s){console.warn("[SurveyFactory] No contract deployed on chain ".concat(t)),v(null);return}let i=new n.NZ(s,l.abi,e);v(i),console.log("[SurveyFactory] Contract initialized:",s)}catch(e){console.error("[SurveyFactory] Failed to initialize contract:",e),v(null)}},[e,t]);let f=(0,r.useCallback)(async e=>{if(!m||!u)throw Error("Contract or FHEVM instance not ready");x(!0),b(null);try{console.log("[SurveyFactory] Creating survey:",e.title);let r=Math.floor(Date.now()/1e3)+60;console.log("[SurveyFactory] Start time:",new Date(1e3*r).toISOString()),console.log("[SurveyFactory] End time:",new Date(1e3*e.endTime).toISOString());let n=await m.createSurvey(e.title,e.description,r,e.endTime,e.maxParticipants,e.privacyLevel,e.allowMultiple,e.questions);console.log("[SurveyFactory] Transaction sent:",n.hash);let s=await n.wait();console.log("[SurveyFactory] Transaction confirmed:",s.hash);let i=s.logs.find(e=>{try{var t;return(null===(t=m.interface.parseLog(e))||void 0===t?void 0:t.name)==="SurveyCreated"}catch(e){return!1}}),l="0";if(i){var t,a;let e=m.interface.parseLog(i);l=(null==e?void 0:null===(a=e.args)||void 0===a?void 0:null===(t=a.surveyId)||void 0===t?void 0:t.toString())||"0"}return x(!1),{success:!0,surveyId:l,txHash:s.hash}}catch(e){throw console.error("[SurveyFactory] Create survey failed:",e),b(e),x(!1),e}},[m,u]),S=(0,r.useCallback)(async(t,a)=>{if(!e)return null;try{let r=new n.NZ(t,d.L.abi,e).getFunction("surveyInfo"),s=await r(),i=Math.floor(Date.now()/1e3)>Number(s.endTime)?"ended":"active";return{id:a,address:t,title:s.title,creator:s.creator,status:i,startTime:Number(s.startTime),endTime:Number(s.endTime),maxParticipants:Number(s.maxParticipants),currentParticipants:0}}catch(e){return console.error("[SurveyFactory] Failed to load survey ".concat(t,":"),e),null}},[e]),w=(0,r.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!m||!e)return[];try{let e=await m.getSurveysPaginated(t,a);console.log("[SurveyFactory] Fetched survey addresses:",e.length);let r=e.map((e,a)=>S(e,(t+a).toString())),n=(await Promise.all(r)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded survey details:",n.length),n}catch(e){return console.error("[SurveyFactory] Failed to fetch surveys:",e),[]}},[m,e,S]),T=(0,r.useCallback)(async()=>{if(!m||!y||!e)return[];try{let e=await m.getSurveysByCreator(y);console.log("[SurveyFactory] My survey addresses:",e.length);let t=e.map((e,t)=>S(e,t.toString())),a=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my survey details:",a.length),a}catch(e){return console.error("[SurveyFactory] Failed to fetch my surveys:",e),[]}},[m,y,e,S]),N=(0,r.useCallback)(async()=>{if(!m||!y||!e)return[];try{let e=await m.getSurveysByParticipant(y);console.log("[SurveyFactory] My participation addresses:",e.length);let t=e.map((e,t)=>S(e,t.toString())),a=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my participation details:",a.length),a}catch(e){return console.error("[SurveyFactory] Failed to fetch my participations:",e),[]}},[m,y,e,S]),j=(0,r.useCallback)(async e=>{if(!m)throw Error("Contract not initialized");try{console.log("[SurveyFactory] Getting survey address for index:",e);let t=m.getFunction("surveys"),a=await t(e);return console.log("[SurveyFactory] Survey address:",a),String(a)}catch(e){throw console.error("[SurveyFactory] Failed to get survey address:",e),e}},[m]);return{contract:m,isLoading:g||p,error:h,isReady:!!m&&!!u&&a,createSurvey:f,getSurveys:w,getMySurveys:T,getMyParticipations:N,getSurveyAddress:j}}}},e=>{var t=t=>e(e.s=t);e.O(0,[250,506,203,441,517,358],()=>t(8404)),_N_E=e.O()}]);