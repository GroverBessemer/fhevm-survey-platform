(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[323],{4426:(e,t,r)=>{Promise.resolve().then(r.bind(r,729))},729:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>c});var a=r(5155),n=r(8506),s=r(9959),i=r(9827),l=r(2115),o=r(8173),d=r.n(o),u=r(6046);function c(){let e=(0,u.useRouter)(),{isConnected:t,address:r}=(0,s.v)(),{createSurvey:o,isLoading:c,isReady:y}=(0,i.q)(),[p,m]=(0,l.useState)(""),[g,x]=(0,l.useState)(""),[h,v]=(0,l.useState)(""),[b,f]=(0,l.useState)(0),[w,S]=(0,l.useState)(0),[j,N]=(0,l.useState)(!1),[k,T]=(0,l.useState)([{type:0,text:"",options:["",""],required:!0}]),[C,F]=(0,l.useState)(!1),P=e=>{let t=[...k];t[e].options.push(""),T(t)},M=async()=>{if(!y){alert("Please wait for contract to initialize...");return}if(!p.trim()){alert("Please enter a survey title");return}if(!h){alert("Please select an end date");return}let t=Math.floor(new Date(h).getTime()/1e3);if(t<=Math.floor(Date.now()/1e3)+120){alert("End date must be at least 2 minutes in the future");return}if(k.some(e=>!e.text.trim())){alert("Please fill in all question texts");return}for(let e=0;e<k.length;e++){let t=k[e];if((0===t.type||1===t.type)&&t.options.filter(e=>""!==e.trim()).length<2){alert("Question ".concat(e+1,": Please provide at least 2 options for ").concat(0===t.type?"Single":"Multiple"," Choice questions"));return}}F(!0);try{let r=k.map(e=>{let t;return t=2===e.type?Array.from({length:10},(e,t)=>(t+1).toString()):3===e.type?Array.from({length:5},(e,t)=>(t+1).toString()):e.options.filter(e=>""!==e.trim()),{questionText:e.text,questionType:e.type,options:t,required:e.required}});console.log("Creating survey:",{title:p,endTimestamp:t,questions:r});let a=await o({title:p,description:g,endTime:t,maxParticipants:b,privacyLevel:w,allowMultiple:j,questions:r});console.log("Survey created:",a),alert("Survey created successfully! Survey ID: ".concat(a.surveyId)),e.push("/my-surveys")}catch(e){console.error("Failed to create survey:",e),alert("Failed to create survey: ".concat(e.message||"Unknown error"))}finally{F(!1)}};return t?(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(n.V,{}),(0,a.jsxs)("div",{className:"max-w-4xl mx-auto px-6 py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Create Encrypted Survey"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"All responses will be encrypted on-chain using FHEVM"})]}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Basic Information"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Survey Title *"}),(0,a.jsx)("input",{type:"text",value:p,onChange:e=>m(e.target.value),className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Enter survey title"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Description"}),(0,a.jsx)("textarea",{value:g,onChange:e=>x(e.target.value),rows:4,className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Describe your survey..."})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"End Date"}),(0,a.jsx)("input",{type:"datetime-local",value:h,onChange:e=>v(e.target.value),min:(()=>{let e=new Date;return e.setMinutes(e.getMinutes()+2),e.toISOString().slice(0,16)})(),className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Max Participants"}),(0,a.jsx)("input",{type:"number",min:"0",value:b,onChange:e=>f(parseInt(e.target.value)||0),placeholder:"0 = unlimited",className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})]})]})]}),(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Questions"}),(0,a.jsx)("button",{onClick:()=>{T([...k,{type:0,text:"",options:["",""],required:!0}])},className:"px-4 py-2 bg-secondary text-white rounded-lg hover:bg-cyan-600 transition-colors text-sm font-semibold",children:"+ Add Question"})]}),(0,a.jsx)("div",{className:"space-y-6",children:k.map((e,t)=>(0,a.jsxs)("div",{className:"p-6 bg-white/50 dark:bg-gray-800/50 rounded-xl border border-gray-200 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsxs)("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:["Question ",t+1]}),(0,a.jsxs)("select",{className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm",children:[(0,a.jsx)("option",{value:"single",children:"Single Choice"}),(0,a.jsx)("option",{value:"multiple",children:"Multiple Choice"}),(0,a.jsx)("option",{value:"rating",children:"Rating (1-5)"}),(0,a.jsx)("option",{value:"scale",children:"Likert Scale"})]})]}),(0,a.jsx)("input",{type:"text",value:e.text,onChange:e=>{let r=[...k];r[t].text=e.target.value,T(r)},className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg mb-4 focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Enter question text"}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300",children:"Options"}),e.options.map((e,r)=>(0,a.jsx)("input",{type:"text",value:e,onChange:e=>{let a=[...k];a[t].options[r]=e.target.value,T(a)},className:"w-full px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg text-sm focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Option ".concat(r+1)},r)),(0,a.jsx)("button",{onClick:()=>P(t),className:"text-sm text-primary hover:text-blue-600 font-semibold",children:"+ Add Option"})]})]},t))})]}),(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:"Privacy Settings"}),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Results Visibility"}),(0,a.jsxs)("select",{value:w,onChange:e=>S(parseInt(e.target.value)),className:"w-full px-4 py-3 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[(0,a.jsx)("option",{value:"0",children:"Creator Only (Default)"}),(0,a.jsx)("option",{value:"1",children:"Public After End"}),(0,a.jsx)("option",{value:"2",children:"Participants Can View Stats"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)("input",{type:"checkbox",id:"allowMultiple",checked:j,onChange:e=>N(e.target.checked),className:"w-5 h-5 text-primary border-gray-300 rounded focus:ring-primary"}),(0,a.jsx)("label",{htmlFor:"allowMultiple",className:"text-sm text-gray-700 dark:text-gray-300",children:"Allow multiple submissions from same address"})]})]})]}),(0,a.jsxs)("div",{className:"flex gap-4",children:[(0,a.jsx)("button",{onClick:M,disabled:C||!y||c,className:"flex-1 px-8 py-4 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all duration-200 shadow-lg text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:C?"⏳ Creating...":y?"\uD83D\uDD10 Deploy Encrypted Survey":"⏳ Initializing..."}),(0,a.jsx)(d(),{href:"/",className:"px-8 py-4 bg-white text-gray-700 border-2 border-gray-300 rounded-lg hover:bg-gray-50 transition-all duration-200 text-lg font-semibold text-center",children:"Cancel"})]}),(0,a.jsx)("div",{className:"glass p-6 rounded-xl",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsx)("strong",{children:"Note:"})," All responses will be encrypted on-chain using FHEVM. Only authorized parties will be able to decrypt the results based on your privacy settings."]})})]})]})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(n.V,{}),(0,a.jsx)("div",{className:"max-w-2xl mx-auto px-6 py-20 text-center",children:(0,a.jsxs)("div",{className:"glass p-12 rounded-2xl",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Connect Your Wallet"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:"Please connect your wallet to create a survey."}),(0,a.jsx)(d(),{href:"/",className:"inline-block px-8 py-3 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all",children:"Go Back"})]})})]})}},9827:(e,t,r)=>{"use strict";r.d(t,{q:()=>u});var a=r(2115),n=r(5631),s=r(9959),i=r(6778);let l={abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"surveyAddress",type:"address"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint256",name:"surveyId",type:"uint256"}],name:"SurveyCreated",type:"event"},{inputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint32",name:"maxParticipants",type:"uint32"},{internalType:"enum Survey.PrivacyLevel",name:"privacyLevel",type:"uint8"},{internalType:"bool",name:"allowMultiple",type:"bool"},{components:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],internalType:"struct Survey.Question[]",name:"questions",type:"tuple[]"}],name:"createSurvey",outputs:[{internalType:"address",name:"surveyAddress",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"creatorSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getSurveyCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"creator",type:"address"}],name:"getSurveysByCreator",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"}],name:"getSurveysByParticipant",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"offset",type:"uint256"},{internalType:"uint256",name:"limit",type:"uint256"}],name:"getSurveysPaginated",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"participantSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"surveyAddress",type:"address"}],name:"recordParticipation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"surveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}]},o={0xaa36a7:{address:"0x629a3C8DE3C6083C0E24f36E9D2Ec977130B68FF",chainId:0xaa36a7,chainName:"sepolia"},31337:{address:"0x71A42B3B6bB0D1772C47605400De02F985d400A7",chainId:31337,chainName:"hardhat"}};var d=r(3186);function u(){let{signer:e,chainId:t,isConnected:r,address:u,rawProvider:c}=(0,s.v)(),{instance:y,isLoading:p}=(0,i.w)(c),[m,g]=(0,a.useState)(null),[x,h]=(0,a.useState)(!1),[v,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!e||!t){g(null);return}try{var r;let a=t.toString(),s=null===(r=o[a])||void 0===r?void 0:r.address;if(!s){console.warn("[SurveyFactory] No contract deployed on chain ".concat(t)),g(null);return}let i=new n.NZ(s,l.abi,e);g(i),console.log("[SurveyFactory] Contract initialized:",s)}catch(e){console.error("[SurveyFactory] Failed to initialize contract:",e),g(null)}},[e,t]);let f=(0,a.useCallback)(async e=>{if(!m||!y)throw Error("Contract or FHEVM instance not ready");h(!0),b(null);try{console.log("[SurveyFactory] Creating survey:",e.title);let a=Math.floor(Date.now()/1e3)+60;console.log("[SurveyFactory] Start time:",new Date(1e3*a).toISOString()),console.log("[SurveyFactory] End time:",new Date(1e3*e.endTime).toISOString());let n=await m.createSurvey(e.title,e.description,a,e.endTime,e.maxParticipants,e.privacyLevel,e.allowMultiple,e.questions);console.log("[SurveyFactory] Transaction sent:",n.hash);let s=await n.wait();console.log("[SurveyFactory] Transaction confirmed:",s.hash);let i=s.logs.find(e=>{try{var t;return(null===(t=m.interface.parseLog(e))||void 0===t?void 0:t.name)==="SurveyCreated"}catch(e){return!1}}),l="0";if(i){var t,r;let e=m.interface.parseLog(i);l=(null==e?void 0:null===(r=e.args)||void 0===r?void 0:null===(t=r.surveyId)||void 0===t?void 0:t.toString())||"0"}return h(!1),{success:!0,surveyId:l,txHash:s.hash}}catch(e){throw console.error("[SurveyFactory] Create survey failed:",e),b(e),h(!1),e}},[m,y]),w=(0,a.useCallback)(async(t,r)=>{if(!e)return null;try{let a=new n.NZ(t,d.L.abi,e).getFunction("surveyInfo"),s=await a(),i=Math.floor(Date.now()/1e3)>Number(s.endTime)?"ended":"active";return{id:r,address:t,title:s.title,creator:s.creator,status:i,startTime:Number(s.startTime),endTime:Number(s.endTime),maxParticipants:Number(s.maxParticipants),currentParticipants:0}}catch(e){return console.error("[SurveyFactory] Failed to load survey ".concat(t,":"),e),null}},[e]),S=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!m||!e)return[];try{let e=await m.getSurveysPaginated(t,r);console.log("[SurveyFactory] Fetched survey addresses:",e.length);let a=e.map((e,r)=>w(e,(t+r).toString())),n=(await Promise.all(a)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded survey details:",n.length),n}catch(e){return console.error("[SurveyFactory] Failed to fetch surveys:",e),[]}},[m,e,w]),j=(0,a.useCallback)(async()=>{if(!m||!u||!e)return[];try{let e=await m.getSurveysByCreator(u);console.log("[SurveyFactory] My survey addresses:",e.length);let t=e.map((e,t)=>w(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my survey details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my surveys:",e),[]}},[m,u,e,w]),N=(0,a.useCallback)(async()=>{if(!m||!u||!e)return[];try{let e=await m.getSurveysByParticipant(u);console.log("[SurveyFactory] My participation addresses:",e.length);let t=e.map((e,t)=>w(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my participation details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my participations:",e),[]}},[m,u,e,w]),k=(0,a.useCallback)(async e=>{if(!m)throw Error("Contract not initialized");try{console.log("[SurveyFactory] Getting survey address for index:",e);let t=m.getFunction("surveys"),r=await t(e);return console.log("[SurveyFactory] Survey address:",r),String(r)}catch(e){throw console.error("[SurveyFactory] Failed to get survey address:",e),e}},[m]);return{contract:m,isLoading:x||p,error:v,isReady:!!m&&!!y&&r,createSurvey:f,getSurveys:S,getMySurveys:j,getMyParticipations:N,getSurveyAddress:k}}},6046:(e,t,r)=>{"use strict";var a=r(6658);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[250,506,203,441,517,358],()=>t(4426)),_N_E=e.O()}]);