(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[515],{356:(e,t,r)=>{Promise.resolve().then(r.bind(r,5580))},5580:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>y});var a=r(5155),s=r(8506),o=r(6046),n=r(2115),l=r(8029),i=r(6778),c=r(9959),d=r(5631),u=r(3186);function y(){let e=(0,o.useParams)(),t=(0,o.useRouter)(),r=e.id,{surveyInfo:y,questions:x,isLoading:p}=(0,l.Y)(r),{submitAnswers:g,isSubmitting:h}=function(e){let{signer:t,rawProvider:r}=(0,c.v)(),{instance:a}=(0,i.w)(r),[s,o]=(0,n.useState)(!1),[l,y]=(0,n.useState)(null);return{submitAnswers:(0,n.useCallback)(async r=>{if(!t||!a||!e)throw Error("Wallet, FHEVM instance, or survey address not ready");o(!0),y(null);try{console.log("[SurveyParticipate] Submitting answers:",r);let s=new d.NZ(e,u.L.abi,t),n=await t.getAddress(),l=await s.getQuestionCount();console.log("[SurveyParticipate] Question count:",Number(l));let i=a.createEncryptedInput(e,n);for(let e=0;e<Number(l);e++){let t=r[e];if(null==t)console.log("[SurveyParticipate] Q".concat(e,": No answer, using 0")),i.add32(0);else if(Array.isArray(t)){let r=0;t.forEach(e=>{r|=1<<e}),console.log("[SurveyParticipate] Q".concat(e,": Multiple choice bitmask = ").concat(r)),i.add32(r)}else console.log("[SurveyParticipate] Q".concat(e,": Single value = ").concat(t)),i.add32(Number(t))}let c=await i.encrypt();console.log("[SurveyParticipate] Encrypted input created"),console.log("[SurveyParticipate] Handles:",c.handles),console.log("[SurveyParticipate] Handles length:",c.handles.length),console.log("[SurveyParticipate] Handles type:",typeof c.handles),console.log("[SurveyParticipate] First handle:",c.handles[0]),console.log("[SurveyParticipate] First handle type:",typeof c.handles[0]),console.log("[SurveyParticipate] InputProof:",c.inputProof);let y=await s.submitAnswers(c.handles,c.inputProof);console.log("[SurveyParticipate] Transaction sent:",y.hash);let x=await y.wait();return console.log("[SurveyParticipate] Transaction confirmed:",x.hash),o(!1),{success:!0,txHash:x.hash}}catch(t){console.error("[SurveyParticipate] Submission failed:",t);let e=t instanceof Error?t:Error(String(t));throw y(e),o(!1),e}},[t,a,e]),isSubmitting:s,error:l}}(r),{isConnected:m}=(0,c.v)(),[b,v]=(0,n.useState)({}),f=async()=>{if(!m){alert("Please connect your wallet first");return}for(let e=0;e<x.length;e++){let t=x[e];if(t.required&&(void 0===b[e]||null===b[e])){alert("Please answer question ".concat(e+1,": ").concat(t.questionText));return}}try{console.log("Submitting encrypted answers:",b);let r=await g(b);r.success&&(alert("Survey submitted successfully! Transaction: ".concat(r.txHash)),t.push("/surveys/".concat(e.id,"/thankyou")))}catch(e){console.error("Submission error:",e),alert("Failed to submit survey: ".concat(e.message||"Unknown error"))}};if(p)return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(s.V,{}),(0,a.jsx)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:(0,a.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading survey..."})]})})]});if(!y)return(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(s.V,{}),(0,a.jsx)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:(0,a.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,a.jsx)("div",{className:"text-6xl mb-4",children:"❌"}),(0,a.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Survey Not Found"})]})})]});let w=e=>["Single Choice","Multiple Choice","Rating","Scale"][e]||"Unknown";return console.log("[Participate] Questions loaded:",x.length),x.forEach((e,t)=>{var r;console.log("[Participate] Q".concat(t+1,":"),{text:e.questionText,type:e.questionType,optionsCount:(null===(r=e.options)||void 0===r?void 0:r.length)||0,options:e.options})}),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(s.V,{}),(0,a.jsxs)("div",{className:"max-w-3xl mx-auto px-6 py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:y.title}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Your answers will be encrypted on-chain using FHEVM"})]}),0===x.length?(0,a.jsx)("div",{className:"glass p-12 rounded-2xl text-center",children:(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No questions found in this survey."})}):(0,a.jsx)("div",{className:"space-y-6",children:x.map((e,t)=>(0,a.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,a.jsxs)("div",{className:"flex items-start space-x-3 mb-6",children:[(0,a.jsxs)("span",{className:"px-3 py-1 bg-primary/10 text-primary rounded-full text-sm font-semibold",children:["Q",t+1]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("h3",{className:"text-xl font-semibold text-gray-900 dark:text-white mb-2",children:e.questionText}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Type: ",w(e.questionType),e.required&&" • Required"]})]})]}),0===e.questionType&&(e.options&&e.options.length>0?(0,a.jsx)("div",{className:"space-y-3",children:e.options.map((e,r)=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-4 bg-white dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors border-2 border-transparent hover:border-primary",children:[(0,a.jsx)("input",{type:"radio",name:"question-".concat(t),value:r,onChange:e=>v({...b,[t]:parseInt(e.target.value)}),className:"w-5 h-5 text-primary"}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:e})]},r))}):(0,a.jsx)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:["No options available for this question. (Debug: options = ",JSON.stringify(e.options),")"]})})),2===e.questionType&&(0,a.jsx)("div",{className:"flex space-x-4 justify-center py-4",children:Array.from({length:10},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>v({...b,[t]:e}),className:"w-12 h-12 rounded-full font-bold transition-all ".concat(b[t]===e?"bg-primary text-white scale-110":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:scale-105"),children:e},e))}),3===e.questionType&&(0,a.jsx)("div",{className:"flex space-x-4 justify-center py-4",children:Array.from({length:5},(e,t)=>t+1).map(e=>(0,a.jsx)("button",{onClick:()=>v({...b,[t]:e}),className:"w-16 h-16 rounded-lg font-bold text-lg transition-all ".concat(b[t]===e?"bg-primary text-white scale-110":"bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:scale-105"),children:e},e))}),1===e.questionType&&(e.options&&e.options.length>0?(0,a.jsx)("div",{className:"space-y-3",children:e.options.map((e,r)=>(0,a.jsxs)("label",{className:"flex items-center space-x-3 p-4 bg-white dark:bg-gray-800 rounded-lg cursor-pointer hover:bg-blue-50 dark:hover:bg-gray-700 transition-colors border-2 border-transparent hover:border-primary",children:[(0,a.jsx)("input",{type:"checkbox",value:r,onChange:e=>{let a=b[t]||[];e.target.checked?v({...b,[t]:[...a,r]}):v({...b,[t]:a.filter(e=>e!==r)})},className:"w-5 h-5 text-primary"}),(0,a.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:e})]},r))}):(0,a.jsx)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:["No options available for this question. (Debug: options = ",JSON.stringify(e.options),")"]})}))]},t))}),(0,a.jsxs)("div",{className:"mt-8 flex gap-4",children:[(0,a.jsx)("button",{onClick:f,disabled:h||!m,className:"flex-1 px-8 py-4 rounded-lg transition-all duration-200 shadow-lg text-lg font-semibold ".concat(h||!m?"bg-gray-400 cursor-not-allowed":"bg-primary text-white hover:bg-blue-600"),children:h?(0,a.jsxs)("span",{className:"flex items-center justify-center",children:[(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Encrypting & Submitting..."]}):"\uD83D\uDD10 Submit Encrypted Answers"}),(0,a.jsx)("button",{onClick:()=>t.back(),disabled:h,className:"px-8 py-4 border-2 border-gray-300 rounded-lg transition-all duration-200 text-lg font-semibold ".concat(h?"bg-gray-100 text-gray-400 cursor-not-allowed":"bg-white text-gray-700 hover:bg-gray-50"),children:"Cancel"})]}),(0,a.jsx)("div",{className:"mt-6 glass p-6 rounded-xl",children:(0,a.jsxs)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsx)("strong",{children:"\uD83D\uDD12 Privacy Note:"})," Your answers will be encrypted using FHEVM before being submitted to the blockchain. Only authorized parties can decrypt the results."]})})]})]})}},8029:(e,t,r)=>{"use strict";r.d(t,{Y:()=>l});var a=r(2115),s=r(5631),o=r(9959),n=r(3186);function l(e){let{signer:t}=(0,o.v)(),[r,l]=(0,a.useState)(null),[i,c]=(0,a.useState)(null),[d,u]=(0,a.useState)([]),[y,x]=(0,a.useState)(!1),[p,g]=(0,a.useState)(null);return(0,a.useEffect)(()=>{if(!t||!e){l(null);return}try{let r=new s.NZ(e,n.L.abi,t);l(r),console.log("[useSurvey] Contract initialized:",e)}catch(e){console.error("[useSurvey] Failed to initialize contract:",e),l(null)}},[t,e]),(0,a.useEffect)(()=>{(async()=>{if(r){x(!0),g(null);try{console.log("[useSurvey] Loading survey data...");let e=r.getFunction("surveyInfo"),t=await e();console.log("[useSurvey] Survey info:",t),c({creator:t.creator,title:t.title,description:t.description,startTime:t.startTime,endTime:t.endTime,maxParticipants:t.maxParticipants,currentParticipants:t.currentParticipants,privacyLevel:t.privacyLevel,allowMultipleSubmissions:t.allowMultipleSubmissions,active:t.active});let a=r.getFunction("getQuestion"),s=[],o=0;for(;;)try{let e=await a(o),t={questionText:e[0],questionType:Number(e[1]),options:Array.isArray(e[2])?e[2]:[],required:!!e[3]};console.log("[useSurvey] Question ".concat(o,":"),{text:t.questionText,type:t.questionType,optionsCount:t.options.length,options:t.options,required:t.required}),s.push(t),o++}catch(e){console.log("[useSurvey] No more questions after index ".concat(o));break}console.log("[useSurvey] Total loaded questions:",s.length),u(s),x(!1)}catch(e){console.error("[useSurvey] Failed to load survey data:",e),g(e instanceof Error?e:Error(String(e))),x(!1)}}})()},[r]),{contract:r,surveyInfo:i,questions:d,isLoading:y,error:p}}},6046:(e,t,r)=>{"use strict";var a=r(6658);r.o(a,"useParams")&&r.d(t,{useParams:function(){return a.useParams}}),r.o(a,"useRouter")&&r.d(t,{useRouter:function(){return a.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[250,506,203,441,517,358],()=>t(356)),_N_E=e.O()}]);