(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[45],{7250:(e,t,r)=>{Promise.resolve().then(r.bind(r,6231))},6231:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>W});var s=r(5155),a=r(8506),n=r(6046),i=r(2115),o=r(5631),l=r(3186),c=r(9959),u=r(6778);function d(e,t,r){if(!t.has(e))throw TypeError("attempted to "+r+" private field on non-instance");return t.get(e)}function y(e,t){var r=d(e,t,"get");return r.get?r.get.call(e):r.value}function p(e,t,r){!function(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}(e,t),t.set(e,r)}function g(e,t,r){var s=d(e,t,"set");return!function(e,t,r){if(t.set)t.set.call(e,r);else{if(!t.writable)throw TypeError("attempted to set read only private field");t.value=r}}(e,s,r),r}var m=r(5237),v=r(1905),h=r(465);function x(){return Math.floor(Date.now()/1e3)}var f=new WeakMap,w=new WeakMap,b=new WeakMap,S=new WeakMap;class N{get contractAddresses(){return y(this,f)}get userAddress(){return y(this,w)}get publicKey(){return y(this,b)}get key(){return y(this,S)}constructor(e,t,r,s){if(p(this,f,{writable:!0,value:void 0}),p(this,w,{writable:!0,value:void 0}),p(this,b,{writable:!0,value:void 0}),p(this,S,{writable:!0,value:void 0}),!m.PW(r))throw TypeError("Invalid address ".concat(r));let a=t.sort(),n=e.createEIP712(null!=s?s:v.j,a,0,0);try{let e=h.z.hash(n.domain,{UserDecryptRequestVerification:n.types.UserDecryptRequestVerification},n.message);g(this,f,a),g(this,w,r),g(this,S,"".concat(r,":").concat(e))}catch(e){throw console.log(e),e}}}var T=new WeakMap,j=new WeakMap,k=new WeakMap,F=new WeakMap,D=new WeakMap,C=new WeakMap,R=new WeakMap,E=new WeakMap;class M{get privateKey(){return y(this,j)}get publicKey(){return y(this,T)}get signature(){return y(this,k)}get contractAddresses(){return y(this,R)}get startTimestamp(){return y(this,F)}get durationDays(){return y(this,D)}get userAddress(){return y(this,C)}static checkIs(e){if(!e||"object"!=typeof e||!("publicKey"in e&&"string"==typeof e.publicKey)||!("privateKey"in e&&"string"==typeof e.privateKey)||!("signature"in e&&"string"==typeof e.signature)||!("startTimestamp"in e&&"number"==typeof e.startTimestamp)||!("durationDays"in e&&"number"==typeof e.durationDays)||!("contractAddresses"in e&&Array.isArray(e.contractAddresses)))return!1;for(let t=0;t<e.contractAddresses.length;++t)if("string"!=typeof e.contractAddresses[t]||!e.contractAddresses[t].startsWith("0x"))return!1;return!!("userAddress"in e&&"string"==typeof e.userAddress&&e.userAddress.startsWith("0x"))&&"eip712"in e&&"object"==typeof e.eip712&&null!==e.eip712&&"domain"in e.eip712&&"object"==typeof e.eip712.domain&&"primaryType"in e.eip712&&"string"==typeof e.eip712.primaryType&&"message"in e.eip712&&"types"in e.eip712&&"object"==typeof e.eip712.types&&null!==e.eip712.types}toJSON(){return{publicKey:y(this,T),privateKey:y(this,j),signature:y(this,k),startTimestamp:y(this,F),durationDays:y(this,D),userAddress:y(this,C),contractAddresses:y(this,R),eip712:y(this,E)}}static fromJSON(e){return new M("string"==typeof e?JSON.parse(e):e)}equals(e){return e.signature===y(this,k)}isValid(){return x()<y(this,F)+86400*y(this,D)}async saveToGenericStringStorage(e,t,r){try{let s=JSON.stringify(this),a=new N(t,y(this,R),y(this,C),r?y(this,T):void 0);await e.setItem(a.key,s),console.log("signature saved! contracts=".concat(y(this,R).length))}catch(e){console.error("FhevmDecryptionSignature.saveToGenericStringStorage() failed!")}}static async loadFromGenericStringStorage(e,t,r,s,a){try{let n=new N(t,r,s,a),i=await e.getItem(n.key);if(!i)return console.warn("Could not load signature! key=".concat(n.key)),null;try{let e=M.fromJSON(i);if(!e.isValid())return null;return e}catch(e){return null}}catch(e){return console.error("FhevmDecryptionSignature.loadFromGenericStringStorage() failed!"),null}}static async new(e,t,r,s,a){try{let n=await a.getAddress(),i=x(),o=e.createEIP712(r,t,i,365),l=await a.signTypedData(o.domain,{UserDecryptRequestVerification:o.types.UserDecryptRequestVerification},o.message);return new M({publicKey:r,privateKey:s,contractAddresses:t,startTimestamp:i,durationDays:365,signature:l,eip712:o,userAddress:n})}catch(e){return null}}static async loadOrSign(e,t,r,s,a){let n=await r.getAddress(),i=await M.loadFromGenericStringStorage(s,e,t,n,null==a?void 0:a.publicKey);if(i)return i;let{publicKey:o,privateKey:l}=null!=a?a:e.generateKeypair(),c=await M.new(e,t,o,l,r);return c?(await c.saveToGenericStringStorage(s,e,!!(null==a?void 0:a.publicKey)),c):null}constructor(e){if(p(this,T,{writable:!0,value:void 0}),p(this,j,{writable:!0,value:void 0}),p(this,k,{writable:!0,value:void 0}),p(this,F,{writable:!0,value:void 0}),p(this,D,{writable:!0,value:void 0}),p(this,C,{writable:!0,value:void 0}),p(this,R,{writable:!0,value:void 0}),p(this,E,{writable:!0,value:void 0}),!M.checkIs(e))throw TypeError("Invalid FhevmDecryptionSignatureType");g(this,T,e.publicKey),g(this,j,e.privateKey),g(this,k,e.signature),g(this,F,e.startTimestamp),g(this,D,e.durationDays),g(this,C,e.userAddress),g(this,R,e.contractAddresses),g(this,E,e.eip712)}}var A=new WeakMap;class P{getItem(e){return window.localStorage.getItem(y(this,A)+e)}setItem(e,t){window.localStorage.setItem(y(this,A)+e,t)}removeItem(e){window.localStorage.removeItem(y(this,A)+e)}constructor(e=""){p(this,A,{writable:!0,value:void 0}),g(this,A,e)}}var I=r(8029),L=r(9827),q=r(8173),O=r.n(q);function W(){let e=(0,n.useParams)().id,{isConnected:t}=(0,c.v)(),{getSurveyAddress:r,isReady:d}=(0,L.q)(),[y,p]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{if(d&&e)try{let t=await r(parseInt(e));console.log("[ResultsPage] Survey address:",t),p(t)}catch(e){console.error("[ResultsPage] Failed to get survey address:",e)}})()},[d,e,r]);let{surveyInfo:g,isLoading:m}=(0,I.Y)(y),{results:v,isLoading:h,isDecrypting:x,isCreator:f,loadResults:w,decryptResults:b}=function(e){let{signer:t,address:r,rawProvider:s}=(0,c.v)(),{instance:a}=(0,u.w)(s),[n,d]=(0,i.useState)([]),[y,p]=(0,i.useState)(!1),[g,m]=(0,i.useState)(!1),[v,h]=(0,i.useState)(null),[x,f]=(0,i.useState)(!1),w=(0,i.useCallback)(async()=>{if(!t||!e){console.log("[SurveyResults] Missing signer or survey address");return}p(!0),h(null);try{let s=new o.NZ(e,l.L.abi,t);console.log("[SurveyResults] Loading results from:",e);let a=s.getFunction("surveyInfo"),n=await a(),i=String(n[0]).toLowerCase();f(i===(null==r?void 0:r.toLowerCase())),console.log("[SurveyResults] Creator:",i),console.log("[SurveyResults] User:",null==r?void 0:r.toLowerCase()),console.log("[SurveyResults] Is creator:",i===(null==r?void 0:r.toLowerCase()));let c=s.getFunction("getQuestion"),u=[],y=0;for(;;)try{let e=await c(y),t=String(e[0]),r=Number(e[1]),a=Array.isArray(e[2])?e[2].map(String):[];console.log("[SurveyResults] Q".concat(y,": ").concat(t,", options: ").concat(a.length));let n=[],i=s.getFunction("getOptionCount");for(let e=0;e<a.length;e++)try{let t=await i(y,e),r="bigint"==typeof t?t:BigInt(t.toString());n.push(r),console.log("[SurveyResults] Q".concat(y," Option ").concat(e," handle:"),r.toString())}catch(t){console.warn("[SurveyResults] Failed to get count for Q".concat(y," O").concat(e,":"),t),n.push(BigInt(0))}u.push({questionText:t,questionType:r,options:a,optionCounts:n}),y++}catch(e){console.log("[SurveyResults] No more questions after index ".concat(y));break}d(u),console.log("[SurveyResults] Loaded results:",u)}catch(e){console.error("[SurveyResults] Failed to load results:",e),h(e instanceof Error?e:Error(String(e)))}finally{p(!1)}},[t,e,r]),b=(0,i.useCallback)(async()=>{if(!t||!e||!a||0===n.length){console.log("[SurveyResults] Cannot decrypt: missing requirements");return}if(!r){console.log("[SurveyResults] No user address");return}m(!0),h(null);try{let s=new o.NZ(e,l.L.abi,t);console.log("[SurveyResults] Starting decryption for survey:",e);try{let e=s.getFunction("allowResultsDecryption"),t=await e();console.log("[SurveyResults] Calling allowResultsDecryption, tx:",t.hash),await t.wait(),console.log("[SurveyResults] allowResultsDecryption confirmed")}catch(e){console.log("[SurveyResults] allowResultsDecryption error (may be ok):",e.message)}let i=new P("fhevm.decryptionSignature.".concat(r.toLowerCase()));console.log("[SurveyResults] Loading/creating decryption signature...");let c=await M.loadOrSign(a,[e],t,i);if(!c)throw Error("Failed to create decryption signature");console.log("[SurveyResults] Decryption signature ready");let u=[];if(n.forEach((t,r)=>{t.optionCounts.forEach((t,s)=>{if(t===BigInt(0)){console.log("[SurveyResults] Skipping Q".concat(r," O").concat(s,": zero handle"));return}let a=t.toString(16);for(;a.length<64;)a="0"+a;let n="0x"+a;console.log("[SurveyResults] Q".concat(r," O").concat(s," handle: ").concat(n)),u.push({handle:n,contractAddress:e,qIndex:r,oIndex:s})})}),console.log("[SurveyResults] Total handles to decrypt:",u.length),0===u.length){console.log("[SurveyResults] No handles to decrypt"),m(!1);return}let y=u.map(e=>{let{handle:t,contractAddress:r}=e;return{handle:t,contractAddress:r}});console.log("[SurveyResults] Calling userDecrypt...");let p=await a.userDecrypt(y,c.privateKey,c.publicKey,c.signature,c.contractAddresses,c.userAddress,c.startTimestamp,c.durationDays);console.log("[SurveyResults] userDecrypt completed, decrypted values:",p);let g=new Map;u.forEach(e=>{let{handle:t,qIndex:r,oIndex:s}=e,a=p[t],n=Number(a);g.set("".concat(r,"-").concat(s),n),console.log("[SurveyResults] Q".concat(r," O").concat(s,": ").concat(n))});let v=n.map((e,t)=>{let r=e.optionCounts.map((e,r)=>g.get("".concat(t,"-").concat(r))||0);return{...e,decryptedCounts:r}});d(v),console.log("[SurveyResults] Decryption complete!")}catch(e){console.error("[SurveyResults] Decryption failed:",e),h(e instanceof Error?e:Error(String(e)))}finally{m(!1)}},[t,e,a,n,r]);return{results:n,isLoading:y,isDecrypting:g,isCreator:x,error:v,loadResults:w,decryptResults:b}}(y);(0,i.useEffect)(()=>{t&&y&&w()},[t,y,w]);let S=v.some(e=>e.decryptedCounts&&e.decryptedCounts.length>0);return t?(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,s.jsx)(a.V,{}),(0,s.jsxs)("div",{className:"max-w-6xl mx-auto px-6 py-12",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)(O(),{href:"/surveys/".concat(e),className:"inline-flex items-center text-primary hover:text-blue-600 mb-4",children:"← Back to Survey"}),(0,s.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Survey Results"}),g&&(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:g.title})]}),(h||m)&&(0,s.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,s.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading results..."})]}),!h&&!m&&0===v.length&&(0,s.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,s.jsx)("div",{className:"text-6xl mb-4",children:"\uD83D\uDCCA"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"No results available yet"})]}),!h&&!m&&v.length>0&&!S&&(0,s.jsxs)("div",{className:"glass p-8 rounded-2xl mb-8 text-center",children:[(0,s.jsx)("div",{className:"text-5xl mb-4",children:"\uD83D\uDD10"}),(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-4",children:"Results are Encrypted"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-2",children:f?"You are the survey creator. Click below to decrypt the results.":"Only the survey creator can decrypt and view the results."}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mb-6",children:"\uD83D\uDD12 All vote counts are encrypted on-chain using FHEVM"}),f&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{onClick:b,disabled:x,className:"px-8 py-4 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all duration-200 shadow-lg text-lg font-semibold disabled:opacity-50 disabled:cursor-not-allowed",children:x?"⏳ Decrypting...":"\uD83D\uDD13 Decrypt Results"}),(0,s.jsx)("p",{className:"text-sm text-gray-500 mt-4",children:"This will request decryption from the FHEVM network"})]}),!f&&(0,s.jsx)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:(0,s.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300",children:"⚠️ You don't have permission to decrypt these results"})})]}),!h&&!m&&S&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[(0,s.jsxs)("div",{className:"glass p-6 rounded-xl text-center",children:[(0,s.jsx)("div",{className:"text-4xl font-bold text-primary mb-2",children:v.reduce((e,t)=>{var r;return e+((null===(r=t.decryptedCounts)||void 0===r?void 0:r.reduce((e,t)=>e+t,0))||0)},0)}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Total Responses"})]}),(0,s.jsxs)("div",{className:"glass p-6 rounded-xl text-center",children:[(0,s.jsx)("div",{className:"text-4xl font-bold text-secondary mb-2",children:v.length}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Questions"})]}),(0,s.jsxs)("div",{className:"glass p-6 rounded-xl text-center",children:[(0,s.jsx)("div",{className:"text-4xl font-bold text-accent mb-2",children:"✅"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Encrypted On-Chain"})]})]}),(0,s.jsx)("div",{className:"space-y-8",children:v.map((e,t)=>{var r;let a=(null===(r=e.decryptedCounts)||void 0===r?void 0:r.reduce((e,t)=>e+t,0))||0;return(0,s.jsxs)("div",{className:"glass p-8 rounded-2xl",children:[(0,s.jsxs)("h3",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-6",children:[t+1,". ",e.questionText]}),(0,s.jsx)("div",{className:"space-y-4",children:e.options.map((t,r)=>{var n;let i=(null===(n=e.decryptedCounts)||void 0===n?void 0:n[r])||0,o=a>0?i/a*100:0;return(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300 font-medium",children:t}),(0,s.jsxs)("span",{className:"text-gray-600 dark:text-gray-400",children:[i," votes (",o.toFixed(1),"%)"]})]}),(0,s.jsx)("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-3 overflow-hidden",children:(0,s.jsx)("div",{className:"bg-gradient-to-r from-primary to-secondary h-full rounded-full transition-all duration-500",style:{width:"".concat(o,"%")}})})]},r)})}),(0,s.jsx)("div",{className:"mt-6 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm font-semibold",children:[(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:"Total Responses"}),(0,s.jsx)("span",{className:"text-primary",children:a})]})})]},t)})}),(0,s.jsxs)("div",{className:"mt-8 glass p-6 rounded-xl",children:[(0,s.jsx)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-3",children:"\uD83D\uDD12 Privacy-Preserving Results"}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-2",children:"All survey responses were encrypted on-chain using FHEVM technology. The vote counts above were decrypted using your creator permissions."}),(0,s.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Individual responses remain private and cannot be traced back to participants."})]})]}),!h&&!m&&v.length>0&&!S&&(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Encrypted Results Preview"}),v.map((e,t)=>(0,s.jsxs)("div",{className:"glass p-6 rounded-xl",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold text-gray-900 dark:text-white mb-4",children:[t+1,". ",e.questionText]}),(0,s.jsx)("div",{className:"space-y-2",children:e.options.map((t,r)=>{var a;return(0,s.jsxs)("div",{className:"flex items-center justify-between text-sm",children:[(0,s.jsx)("span",{className:"text-gray-700 dark:text-gray-300",children:t}),(0,s.jsxs)("span",{className:"text-encrypted font-mono",children:["\uD83D\uDD10 ",null===(a=e.optionCounts[r])||void 0===a?void 0:a.toString().slice(0,16),"..."]})]},r)})})]},t))]})]})]}):(0,s.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,s.jsx)(a.V,{}),(0,s.jsx)("div",{className:"max-w-2xl mx-auto px-6 py-20 text-center",children:(0,s.jsxs)("div",{className:"glass p-12 rounded-2xl",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-4",children:"Connect Your Wallet"}),(0,s.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-8",children:"Please connect your wallet to view survey results."})]})})]})}},8029:(e,t,r)=>{"use strict";r.d(t,{Y:()=>o});var s=r(2115),a=r(5631),n=r(9959),i=r(3186);function o(e){let{signer:t}=(0,n.v)(),[r,o]=(0,s.useState)(null),[l,c]=(0,s.useState)(null),[u,d]=(0,s.useState)([]),[y,p]=(0,s.useState)(!1),[g,m]=(0,s.useState)(null);return(0,s.useEffect)(()=>{if(!t||!e){o(null);return}try{let r=new a.NZ(e,i.L.abi,t);o(r),console.log("[useSurvey] Contract initialized:",e)}catch(e){console.error("[useSurvey] Failed to initialize contract:",e),o(null)}},[t,e]),(0,s.useEffect)(()=>{(async()=>{if(r){p(!0),m(null);try{console.log("[useSurvey] Loading survey data...");let e=r.getFunction("surveyInfo"),t=await e();console.log("[useSurvey] Survey info:",t),c({creator:t.creator,title:t.title,description:t.description,startTime:t.startTime,endTime:t.endTime,maxParticipants:t.maxParticipants,currentParticipants:t.currentParticipants,privacyLevel:t.privacyLevel,allowMultipleSubmissions:t.allowMultipleSubmissions,active:t.active});let s=r.getFunction("getQuestion"),a=[],n=0;for(;;)try{let e=await s(n),t={questionText:e[0],questionType:Number(e[1]),options:Array.isArray(e[2])?e[2]:[],required:!!e[3]};console.log("[useSurvey] Question ".concat(n,":"),{text:t.questionText,type:t.questionType,optionsCount:t.options.length,options:t.options,required:t.required}),a.push(t),n++}catch(e){console.log("[useSurvey] No more questions after index ".concat(n));break}console.log("[useSurvey] Total loaded questions:",a.length),d(a),p(!1)}catch(e){console.error("[useSurvey] Failed to load survey data:",e),m(e instanceof Error?e:Error(String(e))),p(!1)}}})()},[r]),{contract:r,surveyInfo:l,questions:u,isLoading:y,error:g}}},9827:(e,t,r)=>{"use strict";r.d(t,{q:()=>u});var s=r(2115),a=r(5631),n=r(9959),i=r(6778);let o={abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"surveyAddress",type:"address"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint256",name:"surveyId",type:"uint256"}],name:"SurveyCreated",type:"event"},{inputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint32",name:"maxParticipants",type:"uint32"},{internalType:"enum Survey.PrivacyLevel",name:"privacyLevel",type:"uint8"},{internalType:"bool",name:"allowMultiple",type:"bool"},{components:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],internalType:"struct Survey.Question[]",name:"questions",type:"tuple[]"}],name:"createSurvey",outputs:[{internalType:"address",name:"surveyAddress",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"creatorSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getSurveyCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"creator",type:"address"}],name:"getSurveysByCreator",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"}],name:"getSurveysByParticipant",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"offset",type:"uint256"},{internalType:"uint256",name:"limit",type:"uint256"}],name:"getSurveysPaginated",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"participantSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"surveyAddress",type:"address"}],name:"recordParticipation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"surveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}]},l={0xaa36a7:{address:"0x629a3C8DE3C6083C0E24f36E9D2Ec977130B68FF",chainId:0xaa36a7,chainName:"sepolia"},31337:{address:"0x71A42B3B6bB0D1772C47605400De02F985d400A7",chainId:31337,chainName:"hardhat"}};var c=r(3186);function u(){let{signer:e,chainId:t,isConnected:r,address:u,rawProvider:d}=(0,n.v)(),{instance:y,isLoading:p}=(0,i.w)(d),[g,m]=(0,s.useState)(null),[v,h]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null);(0,s.useEffect)(()=>{if(!e||!t){m(null);return}try{var r;let s=t.toString(),n=null===(r=l[s])||void 0===r?void 0:r.address;if(!n){console.warn("[SurveyFactory] No contract deployed on chain ".concat(t)),m(null);return}let i=new a.NZ(n,o.abi,e);m(i),console.log("[SurveyFactory] Contract initialized:",n)}catch(e){console.error("[SurveyFactory] Failed to initialize contract:",e),m(null)}},[e,t]);let w=(0,s.useCallback)(async e=>{if(!g||!y)throw Error("Contract or FHEVM instance not ready");h(!0),f(null);try{console.log("[SurveyFactory] Creating survey:",e.title);let s=Math.floor(Date.now()/1e3)+60;console.log("[SurveyFactory] Start time:",new Date(1e3*s).toISOString()),console.log("[SurveyFactory] End time:",new Date(1e3*e.endTime).toISOString());let a=await g.createSurvey(e.title,e.description,s,e.endTime,e.maxParticipants,e.privacyLevel,e.allowMultiple,e.questions);console.log("[SurveyFactory] Transaction sent:",a.hash);let n=await a.wait();console.log("[SurveyFactory] Transaction confirmed:",n.hash);let i=n.logs.find(e=>{try{var t;return(null===(t=g.interface.parseLog(e))||void 0===t?void 0:t.name)==="SurveyCreated"}catch(e){return!1}}),o="0";if(i){var t,r;let e=g.interface.parseLog(i);o=(null==e?void 0:null===(r=e.args)||void 0===r?void 0:null===(t=r.surveyId)||void 0===t?void 0:t.toString())||"0"}return h(!1),{success:!0,surveyId:o,txHash:n.hash}}catch(e){throw console.error("[SurveyFactory] Create survey failed:",e),f(e),h(!1),e}},[g,y]),b=(0,s.useCallback)(async(t,r)=>{if(!e)return null;try{let s=new a.NZ(t,c.L.abi,e).getFunction("surveyInfo"),n=await s(),i=Math.floor(Date.now()/1e3)>Number(n.endTime)?"ended":"active";return{id:r,address:t,title:n.title,creator:n.creator,status:i,startTime:Number(n.startTime),endTime:Number(n.endTime),maxParticipants:Number(n.maxParticipants),currentParticipants:0}}catch(e){return console.error("[SurveyFactory] Failed to load survey ".concat(t,":"),e),null}},[e]),S=(0,s.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!g||!e)return[];try{let e=await g.getSurveysPaginated(t,r);console.log("[SurveyFactory] Fetched survey addresses:",e.length);let s=e.map((e,r)=>b(e,(t+r).toString())),a=(await Promise.all(s)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded survey details:",a.length),a}catch(e){return console.error("[SurveyFactory] Failed to fetch surveys:",e),[]}},[g,e,b]),N=(0,s.useCallback)(async()=>{if(!g||!u||!e)return[];try{let e=await g.getSurveysByCreator(u);console.log("[SurveyFactory] My survey addresses:",e.length);let t=e.map((e,t)=>b(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my survey details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my surveys:",e),[]}},[g,u,e,b]),T=(0,s.useCallback)(async()=>{if(!g||!u||!e)return[];try{let e=await g.getSurveysByParticipant(u);console.log("[SurveyFactory] My participation addresses:",e.length);let t=e.map((e,t)=>b(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my participation details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my participations:",e),[]}},[g,u,e,b]),j=(0,s.useCallback)(async e=>{if(!g)throw Error("Contract not initialized");try{console.log("[SurveyFactory] Getting survey address for index:",e);let t=g.getFunction("surveys"),r=await t(e);return console.log("[SurveyFactory] Survey address:",r),String(r)}catch(e){throw console.error("[SurveyFactory] Failed to get survey address:",e),e}},[g]);return{contract:g,isLoading:v||p,error:x,isReady:!!g&&!!y&&r,createSurvey:w,getSurveys:S,getMySurveys:N,getMyParticipations:T,getSurveyAddress:j}}},6046:(e,t,r)=>{"use strict";var s=r(6658);r.o(s,"useParams")&&r.d(t,{useParams:function(){return s.useParams}}),r.o(s,"useRouter")&&r.d(t,{useRouter:function(){return s.useRouter}})}},e=>{var t=t=>e(e.s=t);e.O(0,[250,506,203,441,517,358],()=>t(7250)),_N_E=e.O()}]);