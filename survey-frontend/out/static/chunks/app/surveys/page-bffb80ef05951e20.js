(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[154],{795:(e,t,r)=>{Promise.resolve().then(r.bind(r,7284))},7284:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>d});var a=r(5155),n=r(8506),s=r(9827),i=r(8173),l=r.n(i),o=r(2115);function d(){let{getSurveys:e,isReady:t}=(0,s.q)(),[r,i]=(0,o.useState)([]),[d,y]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{(async()=>{if(t){y(!0);try{let t=await e(0,20);i(t)}catch(e){console.error("Failed to load surveys:",e)}finally{y(!1)}}})()},[t,e]),(0,a.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-cyan-50 dark:from-gray-900 dark:to-gray-800",children:[(0,a.jsx)(n.V,{}),(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-6 py-12",children:[(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h1",{className:"text-4xl font-bold text-gray-900 dark:text-white mb-2",children:"Browse Surveys"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Participate in encrypted surveys"})]}),(0,a.jsx)("div",{className:"glass p-6 rounded-2xl mb-8",children:(0,a.jsxs)("div",{className:"flex flex-wrap gap-4",children:[(0,a.jsxs)("select",{className:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[(0,a.jsx)("option",{children:"All Surveys"}),(0,a.jsx)("option",{children:"Active"}),(0,a.jsx)("option",{children:"Ended"})]}),(0,a.jsxs)("select",{className:"px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg",children:[(0,a.jsx)("option",{children:"Sort by: Newest"}),(0,a.jsx)("option",{children:"Sort by: Ending Soon"}),(0,a.jsx)("option",{children:"Sort by: Most Participants"})]}),(0,a.jsx)("input",{type:"search",placeholder:"Search surveys...",className:"flex-1 min-w-[200px] px-4 py-2 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),d&&(0,a.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,a.jsx)("div",{className:"animate-spin w-12 h-12 border-4 border-primary border-t-transparent rounded-full mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"Loading surveys..."})]}),!d&&r.length>0&&(0,a.jsx)("div",{className:"grid md:grid-cols-2 lg:grid-cols-3 gap-6",children:r.map(e=>(0,a.jsxs)(l(),{href:"/surveys/".concat(e.address),className:"glass p-6 rounded-2xl hover:shadow-xl transition-all duration-200 group",children:[(0,a.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,a.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-semibold ".concat("active"===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:"active"===e.status?"Active":"Ended"}),(0,a.jsx)("svg",{className:"w-5 h-5 text-gray-400 group-hover:text-primary transition-colors",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})]}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-3 group-hover:text-primary transition-colors",children:e.title}),(0,a.jsxs)("div",{className:"space-y-2 text-sm text-gray-600 dark:text-gray-400",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDC64"}),(0,a.jsxs)("span",{children:["Creator: ",e.creator.slice(0,6),"...",e.creator.slice(-4)]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("span",{children:"\uD83D\uDD10"}),(0,a.jsx)("span",{className:"text-encrypted font-semibold",children:"Encrypted Survey"})]}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs font-semibold ".concat("active"===e.status?"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 dark:bg-gray-800 dark:text-gray-400"),children:e.status})})]}),(0,a.jsx)("div",{className:"mt-4 pt-4 border-t border-gray-200 dark:border-gray-700",children:(0,a.jsx)("span",{className:"text-primary font-semibold text-sm group-hover:underline",children:"View Details â†’"})})]},e.address))}),!d&&0===r.length&&(0,a.jsxs)("div",{className:"glass p-12 rounded-2xl text-center",children:[(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:"No surveys found"}),(0,a.jsx)(l(),{href:"/create",className:"inline-block px-6 py-3 bg-primary text-white rounded-lg hover:bg-blue-600 transition-all",children:"Create First Survey"})]})]})]})}},9827:(e,t,r)=>{"use strict";r.d(t,{q:()=>y});var a=r(2115),n=r(5631),s=r(9959),i=r(6778);let l={abi:[{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"surveyAddress",type:"address"},{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"},{indexed:!0,internalType:"uint256",name:"surveyId",type:"uint256"}],name:"SurveyCreated",type:"event"},{inputs:[{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"uint32",name:"maxParticipants",type:"uint32"},{internalType:"enum Survey.PrivacyLevel",name:"privacyLevel",type:"uint8"},{internalType:"bool",name:"allowMultiple",type:"bool"},{components:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],internalType:"struct Survey.Question[]",name:"questions",type:"tuple[]"}],name:"createSurvey",outputs:[{internalType:"address",name:"surveyAddress",type:"address"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"creatorSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getSurveyCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"creator",type:"address"}],name:"getSurveysByCreator",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"}],name:"getSurveysByParticipant",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"offset",type:"uint256"},{internalType:"uint256",name:"limit",type:"uint256"}],name:"getSurveysPaginated",outputs:[{internalType:"address[]",name:"",type:"address[]"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"},{internalType:"uint256",name:"",type:"uint256"}],name:"participantSurveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"participant",type:"address"},{internalType:"address",name:"surveyAddress",type:"address"}],name:"recordParticipation",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"surveys",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"}]},o={0xaa36a7:{address:"0x629a3C8DE3C6083C0E24f36E9D2Ec977130B68FF",chainId:0xaa36a7,chainName:"sepolia"},31337:{address:"0x71A42B3B6bB0D1772C47605400De02F985d400A7",chainId:31337,chainName:"hardhat"}};var d=r(3186);function y(){let{signer:e,chainId:t,isConnected:r,address:y,rawProvider:c}=(0,s.v)(),{instance:u,isLoading:p}=(0,i.w)(c),[m,g]=(0,a.useState)(null),[v,x]=(0,a.useState)(!1),[h,b]=(0,a.useState)(null);(0,a.useEffect)(()=>{if(!e||!t){g(null);return}try{var r;let a=t.toString(),s=null===(r=o[a])||void 0===r?void 0:r.address;if(!s){console.warn("[SurveyFactory] No contract deployed on chain ".concat(t)),g(null);return}let i=new n.NZ(s,l.abi,e);g(i),console.log("[SurveyFactory] Contract initialized:",s)}catch(e){console.error("[SurveyFactory] Failed to initialize contract:",e),g(null)}},[e,t]);let f=(0,a.useCallback)(async e=>{if(!m||!u)throw Error("Contract or FHEVM instance not ready");x(!0),b(null);try{console.log("[SurveyFactory] Creating survey:",e.title);let a=Math.floor(Date.now()/1e3)+60;console.log("[SurveyFactory] Start time:",new Date(1e3*a).toISOString()),console.log("[SurveyFactory] End time:",new Date(1e3*e.endTime).toISOString());let n=await m.createSurvey(e.title,e.description,a,e.endTime,e.maxParticipants,e.privacyLevel,e.allowMultiple,e.questions);console.log("[SurveyFactory] Transaction sent:",n.hash);let s=await n.wait();console.log("[SurveyFactory] Transaction confirmed:",s.hash);let i=s.logs.find(e=>{try{var t;return(null===(t=m.interface.parseLog(e))||void 0===t?void 0:t.name)==="SurveyCreated"}catch(e){return!1}}),l="0";if(i){var t,r;let e=m.interface.parseLog(i);l=(null==e?void 0:null===(r=e.args)||void 0===r?void 0:null===(t=r.surveyId)||void 0===t?void 0:t.toString())||"0"}return x(!1),{success:!0,surveyId:l,txHash:s.hash}}catch(e){throw console.error("[SurveyFactory] Create survey failed:",e),b(e),x(!1),e}},[m,u]),S=(0,a.useCallback)(async(t,r)=>{if(!e)return null;try{let a=new n.NZ(t,d.L.abi,e).getFunction("surveyInfo"),s=await a(),i=Math.floor(Date.now()/1e3)>Number(s.endTime)?"ended":"active";return{id:r,address:t,title:s.title,creator:s.creator,status:i,startTime:Number(s.startTime),endTime:Number(s.endTime),maxParticipants:Number(s.maxParticipants),currentParticipants:0}}catch(e){return console.error("[SurveyFactory] Failed to load survey ".concat(t,":"),e),null}},[e]),w=(0,a.useCallback)(async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20;if(!m||!e)return[];try{let e=await m.getSurveysPaginated(t,r);console.log("[SurveyFactory] Fetched survey addresses:",e.length);let a=e.map((e,r)=>S(e,(t+r).toString())),n=(await Promise.all(a)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded survey details:",n.length),n}catch(e){return console.error("[SurveyFactory] Failed to fetch surveys:",e),[]}},[m,e,S]),T=(0,a.useCallback)(async()=>{if(!m||!y||!e)return[];try{let e=await m.getSurveysByCreator(y);console.log("[SurveyFactory] My survey addresses:",e.length);let t=e.map((e,t)=>S(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my survey details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my surveys:",e),[]}},[m,y,e,S]),N=(0,a.useCallback)(async()=>{if(!m||!y||!e)return[];try{let e=await m.getSurveysByParticipant(y);console.log("[SurveyFactory] My participation addresses:",e.length);let t=e.map((e,t)=>S(e,t.toString())),r=(await Promise.all(t)).filter(e=>null!==e);return console.log("[SurveyFactory] Loaded my participation details:",r.length),r}catch(e){return console.error("[SurveyFactory] Failed to fetch my participations:",e),[]}},[m,y,e,S]),j=(0,a.useCallback)(async e=>{if(!m)throw Error("Contract not initialized");try{console.log("[SurveyFactory] Getting survey address for index:",e);let t=m.getFunction("surveys"),r=await t(e);return console.log("[SurveyFactory] Survey address:",r),String(r)}catch(e){throw console.error("[SurveyFactory] Failed to get survey address:",e),e}},[m]);return{contract:m,isLoading:v||p,error:h,isReady:!!m&&!!u&&r,createSurvey:f,getSurveys:w,getMySurveys:T,getMyParticipations:N,getSurveyAddress:j}}}},e=>{var t=t=>e(e.s=t);e.O(0,[250,506,203,441,517,358],()=>t(795)),_N_E=e.O()}]);