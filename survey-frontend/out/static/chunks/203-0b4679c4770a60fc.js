"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{3186:(e,t,n)=>{n.d(t,{L:()=>i});let i={abi:[{inputs:[{internalType:"address",name:"_factory",type:"address"},{internalType:"address",name:"_creator",type:"address"},{internalType:"string",name:"_title",type:"string"},{internalType:"string",name:"_description",type:"string"},{internalType:"uint256",name:"_startTime",type:"uint256"},{internalType:"uint256",name:"_endTime",type:"uint256"},{internalType:"uint32",name:"_maxParticipants",type:"uint32"},{internalType:"enum Survey.PrivacyLevel",name:"_privacyLevel",type:"uint8"},{internalType:"bool",name:"_allowMultiple",type:"bool"},{components:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],internalType:"struct Survey.Question[]",name:"_questions",type:"tuple[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"AlreadySubmitted",type:"error"},{inputs:[],name:"InvalidTime",type:"error"},{inputs:[],name:"MaxParticipantsReached",type:"error"},{inputs:[],name:"NotAuthorized",type:"error"},{inputs:[],name:"SurveyEnded",type:"error"},{inputs:[],name:"SurveyNotActive",type:"error"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"participant",type:"address"},{indexed:!1,internalType:"uint256",name:"questionCount",type:"uint256"}],name:"AnswerSubmitted",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"user",type:"address"}],name:"ResultsDecryptionAllowed",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"timestamp",type:"uint256"}],name:"SurveyClosed",type:"event"},{anonymous:!1,inputs:[{indexed:!0,internalType:"address",name:"creator",type:"address"},{indexed:!1,internalType:"string",name:"title",type:"string"}],name:"SurveyCreated",type:"event"},{inputs:[],name:"allowMyAnswersDecryption",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"allowResultsDecryption",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"closeSurvey",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"factory",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"getCurrentParticipants",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"user",type:"address"}],name:"getHasSubmitted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"questionId",type:"uint256"},{internalType:"uint256",name:"optionId",type:"uint256"}],name:"getOptionCount",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"index",type:"uint256"}],name:"getQuestion",outputs:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"string[]",name:"options",type:"string[]"},{internalType:"bool",name:"required",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"getQuestionCount",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"questionId",type:"uint256"},{internalType:"address",name:"user",type:"address"}],name:"getUserAnswer",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"hasSubmitted",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"uint256",name:"",type:"uint256"}],name:"optionCounts",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"protocolId",outputs:[{internalType:"uint256",name:"",type:"uint256"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"}],name:"questions",outputs:[{internalType:"string",name:"questionText",type:"string"},{internalType:"enum Survey.QuestionType",name:"questionType",type:"uint8"},{internalType:"bool",name:"required",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"externalEuint32[]",name:"encryptedAnswers",type:"bytes32[]"},{internalType:"bytes",name:"inputProof",type:"bytes"}],name:"submitAnswers",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"surveyInfo",outputs:[{internalType:"address",name:"creator",type:"address"},{internalType:"string",name:"title",type:"string"},{internalType:"string",name:"description",type:"string"},{internalType:"uint256",name:"startTime",type:"uint256"},{internalType:"uint256",name:"endTime",type:"uint256"},{internalType:"euint32",name:"maxParticipants",type:"bytes32"},{internalType:"euint32",name:"currentParticipants",type:"bytes32"},{internalType:"enum Survey.PrivacyLevel",name:"privacyLevel",type:"uint8"},{internalType:"bool",name:"allowMultipleSubmissions",type:"bool"},{internalType:"bool",name:"active",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"",type:"uint256"},{internalType:"address",name:"",type:"address"}],name:"userAnswers",outputs:[{internalType:"euint32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"}]}},6778:(e,t,n)=>{n.d(t,{w:()=>v});var i=n(2115),a=n(6943),r=n(2818);let o="https://cdn.zama.ai/relayer-sdk-js/0.2.0/relayer-sdk-js.umd.cjs";r.env.NEXT_PUBLIC_INFURA_KEY;let s={31337:"http://localhost:8545"};class l{isLoaded(){return y(window,this._trace)}async load(){if(console.log("[RelayerSDKLoader] Loading SDK..."),"relayerSDK"in window){if(!u(window.relayerSDK,this._trace))throw Error("RelayerSDKLoader: Unable to load FHEVM Relayer SDK");return console.log("[RelayerSDKLoader] SDK already loaded"),Promise.resolve()}return new Promise((e,t)=>{if(document.querySelector('script[src="'.concat(o,'"]'))){y(window,this._trace)||t(Error("RelayerSDKLoader: window.relayerSDK is invalid.")),e();return}let n=document.createElement("script");n.src=o,n.type="text/javascript",n.async=!0,n.onload=()=>{y(window,this._trace)||(console.log("[RelayerSDKLoader] script onload FAILED"),t(Error("RelayerSDKLoader: window.relayerSDK is invalid after load."))),console.log("[RelayerSDKLoader] SDK loaded successfully"),e()},n.onerror=()=>{console.log("[RelayerSDKLoader] script onerror"),t(Error("RelayerSDKLoader: Failed to load SDK from ".concat(o)))},console.log("[RelayerSDKLoader] Adding script to DOM..."),document.head.appendChild(n)})}constructor(e){this._trace=e.trace}}function u(e,t){return null==e||"object"!=typeof e?(null==t||t("RelayerSDKLoader: relayerSDK is not a valid object"),!1):"initSDK"in e&&"function"==typeof e.initSDK?"createInstance"in e&&"function"==typeof e.createInstance?"SepoliaConfig"in e&&"object"==typeof e.SepoliaConfig||(null==t||t("RelayerSDKLoader: relayerSDK.SepoliaConfig is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.createInstance is invalid"),!1):(null==t||t("RelayerSDKLoader: relayerSDK.initSDK is invalid"),!1)}function y(e,t){return null==e||"object"!=typeof e?(null==t||t("RelayerSDKLoader: window is not valid"),!1):"relayerSDK"in e?u(e.relayerSDK,t):(null==t||t("RelayerSDKLoader: window does not contain 'relayerSDK'"),!1)}class p extends Error{constructor(e,t,n){super(t),this.code=e,this.name="FhevmError",this.cause=n}}class d extends Error{constructor(e="FHEVM operation was cancelled"){super(e),this.name="FhevmAbortError"}}async function c(e){if("string"==typeof e){let t=new a.FR(e);return Number((await t.getNetwork()).chainId)}return Number.parseInt(await e.request({method:"eth_chainId"}),16)}async function m(e){let t=new a.FR(e);try{return await t.send("web3_clientVersion",[])}catch(t){!function(e,t,n){throw new p(e,t,n)}("WEB3_CLIENTVERSION_ERROR","The URL ".concat(e," is not a Web3 node or is not reachable."),t)}finally{t.destroy()}}async function w(e){let t=await m(e);if("string"==typeof t&&t.toLowerCase().includes("hardhat"))try{let t=new a.FR(e),n=await t.send("fhevm_relayer_metadata",[]);if(t.destroy(),!n||"object"!=typeof n||!("ACLAddress"in n&&"string"==typeof n.ACLAddress&&n.ACLAddress.startsWith("0x"))||!("InputVerifierAddress"in n&&"string"==typeof n.InputVerifierAddress&&n.InputVerifierAddress.startsWith("0x"))||!("KMSVerifierAddress"in n&&"string"==typeof n.KMSVerifierAddress&&n.KMSVerifierAddress.startsWith("0x")))return;return n}catch(e){return}}async function f(e,t){let n=await c(e),i="string"==typeof e?e:void 0,a={31337:"http://localhost:8545",...null!=t?t:{}};return n in a?(i||(i=a[n]),{isMock:!0,chainId:n,rpcUrl:i}):{isMock:!1,chainId:n,rpcUrl:i}}let S=()=>!!y(window,console.log)&&!0===window.relayerSDK.__initialized__,b=async()=>new l({trace:console.log}).load(),T=async e=>{if(!y(window,console.log))throw Error("window.relayerSDK is not available");let t=await window.relayerSDK.initSDK(e);if(window.relayerSDK.__initialized__=t,!t)throw Error("window.relayerSDK.initSDK failed.");return!0},g=async e=>{let t=()=>{if(a.aborted)throw new d},i=e=>{r&&r(e)},{signal:a,onStatusChange:r,provider:o,mockChains:s}=e,{isMock:l,rpcUrl:u,chainId:p}=await f(o,s);if(l){let e=await w(u);if(e){i("creating");let a=await Promise.all([n.e(71),n.e(495)]).then(n.bind(n,4495)),r=await a.fhevmMockCreateInstance({rpcUrl:u,chainId:p,metadata:e});return t(),r}}t(),y(window,console.log)||(i("sdk-loading"),await b(),t(),i("sdk-loaded")),S()||(i("sdk-initializing"),await T(),t(),i("sdk-initialized"));let c=window.relayerSDK;console.log("[fhevm] SepoliaConfig:",JSON.stringify(c.SepoliaConfig,null,2));let m={...c.SepoliaConfig,network:o};console.log("[fhevm] Final config:",m),i("creating");try{let e=await c.createInstance(m);return console.log("[fhevm] Instance created successfully!"),t(),e}catch(e){throw console.error("[fhevm] createInstance error:",e),console.error("[fhevm] Error message:",e.message),console.error("[fhevm] Full error:",e),e}};function v(e){let[t,n]=(0,i.useState)(null),[a,r]=(0,i.useState)(!1),[o,l]=(0,i.useState)(null),[u,y]=(0,i.useState)(null),[p,c]=(0,i.useState)(0),m=(0,i.useCallback)(()=>{c(e=>e+1)},[]);return(0,i.useEffect)(()=>{if(!e){n(null),r(!1),l(null),y(null);return}let t=new AbortController,i=!0;return(async()=>{r(!0),l(null),y(null);try{console.log("[useFhevm] Creating FHEVM instance...");let a=await g({provider:e,mockChains:s,signal:t.signal,onStatusChange:e=>{i&&(y(e),console.log("[useFhevm] Status:",e))}});i&&!t.signal.aborted&&(console.log("[useFhevm] FHEVM instance created successfully"),n(a),r(!1))}catch(e){e instanceof d?console.log("[useFhevm] Instance creation aborted"):(console.error("[useFhevm] Failed to create instance:",e),i&&(l(e instanceof Error?e:Error(String(e))),r(!1)))}})(),()=>{i=!1,t.abort()}},[e,p]),{instance:t,isLoading:a,error:o,status:u,retry:m}}}}]);